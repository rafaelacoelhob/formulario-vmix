<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro de Entrega - VMix</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'DM Sans', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #eef1f5;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.08), 0 1px 3px rgba(0,0,0,0.06);
      width: 100%;
      max-width: 580px;
      overflow: hidden;
    }

    /* === Cabe√ßalho / Termo === */
    .header-section {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      padding: 32px 36px 28px;
      color: #fff;
      position: relative;
      overflow: hidden;
    }

    .header-section::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -30%;
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, rgba(74,144,217,0.15) 0%, transparent 70%);
      border-radius: 50%;
    }

    .header-section h1 {
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 4px;
      position: relative;
      letter-spacing: -0.02em;
    }

    .header-section .subtitle {
      color: rgba(255,255,255,0.6);
      font-size: 0.9rem;
      margin-bottom: 20px;
      position: relative;
    }

    .termo-box {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 10px;
      padding: 16px 18px;
      position: relative;
      backdrop-filter: blur(4px);
    }

    .termo-box .termo-label {
      display: inline-block;
      background: rgba(74,144,217,0.3);
      color: rgba(255,255,255,0.9);
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 3px 10px;
      border-radius: 4px;
      margin-bottom: 10px;
    }

    .termo-box p {
      font-family: 'Source Serif 4', Georgia, serif;
      font-size: 0.85rem;
      line-height: 1.6;
      color: rgba(255,255,255,0.75);
      font-style: italic;
    }

    .termo-box p strong {
      color: rgba(255,255,255,0.95);
      font-style: normal;
      font-weight: 600;
    }

    /* === Formul√°rio === */
    .form-body {
      padding: 32px 36px 36px;
    }

    .form-group { margin-bottom: 22px; }

    label {
      display: block;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 7px;
      font-size: 0.92rem;
    }

    label .required { color: #e74c3c; margin-left: 1px; }

    input[type="text"],
    select {
      width: 100%;
      padding: 12px 14px;
      border: 2px solid #e4e7ec;
      border-radius: 10px;
      font-size: 0.95rem;
      font-family: 'DM Sans', sans-serif;
      transition: border-color 0.2s, box-shadow 0.2s;
      outline: none;
      background: #f8f9fb;
      color: #333;
    }

    input[type="text"]:focus,
    select:focus {
      border-color: #4a90d9;
      background: #fff;
      box-shadow: 0 0 0 3px rgba(74,144,217,0.12);
    }

    input::placeholder { color: #b0b8c4; }

    /* === C√¢mera === */
    .camera-section {
      border: 2px solid #e4e7ec;
      border-radius: 10px;
      overflow: hidden;
      background: #000;
    }

    .camera-view {
      width: 100%;
      display: block;
      background: #1a1a2e;
    }

    .camera-controls {
      display: flex;
      gap: 10px;
      padding: 12px;
      background: #1a1a2e;
      justify-content: center;
      align-items: center;
    }

    .btn-capture {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 4px solid #fff;
      background: #e74c3c;
      cursor: pointer;
      transition: transform 0.15s;
    }

    .btn-capture:hover { transform: scale(1.1); }
    .btn-capture:active { transform: scale(0.95); background: #c0392b; }

    .btn-camera-action {
      padding: 8px 14px;
      background: rgba(255,255,255,0.15);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
      font-family: 'DM Sans', sans-serif;
    }

    .btn-start-camera {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 36px 20px;
      background: #f4f6f9;
      border: 2px dashed #ced4de;
      border-radius: 10px;
      cursor: pointer;
      color: #8895a7;
      text-align: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .btn-start-camera:hover {
      border-color: #4a90d9;
      color: #4a90d9;
      background: #f0f5fc;
    }

    .btn-start-camera span {
      font-size: 0.95rem;
      font-weight: 500;
    }

    .btn-start-camera small {
      font-size: 0.8rem;
      opacity: 0.7;
    }

    .btn-start-camera .camera-icon {
      font-size: 1.8rem;
      margin-bottom: 2px;
    }

    /* === Fotos capturadas === */
    .photos-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 12px;
    }

    .photo-thumb {
      position: relative;
      width: 90px;
      height: 90px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
    }

    .photo-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .photo-thumb .remove-photo {
      position: absolute;
      top: 4px; right: 4px;
      width: 22px; height: 22px;
      background: rgba(231,76,60,0.9);
      color: #fff;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .photo-count {
      font-size: 0.85rem;
      color: #8895a7;
      margin-top: 8px;
    }

    /* === Bot√£o submit === */
    .btn-submit {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #4a90d9, #357abd);
      color: #fff;
      border: none;
      border-radius: 10px;
      font-size: 1.05rem;
      font-weight: 600;
      font-family: 'DM Sans', sans-serif;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 8px;
      box-shadow: 0 4px 12px rgba(74,144,217,0.25);
    }

    .btn-submit:hover {
      background: linear-gradient(135deg, #357abd, #2a6aad);
      box-shadow: 0 6px 16px rgba(74,144,217,0.35);
      transform: translateY(-1px);
    }

    .btn-submit:active { transform: translateY(0); }
    .btn-submit:disabled { background: #b8c4d0; cursor: not-allowed; box-shadow: none; transform: none; }

    /* === Loading overlay === */
    .loading-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(255,255,255,0.88);
      backdrop-filter: blur(4px);
      z-index: 999;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 15px;
    }

    .loading-overlay.show { display: flex; }

    .spinner {
      width: 45px; height: 45px;
      border: 5px solid #e0e0e0;
      border-top-color: #4a90d9;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .loading-text { color: #555; font-size: 1rem; }

    /* === Sucesso === */
    .success-message {
      display: none;
      text-align: center;
      padding: 40px 30px;
    }

    .success-message .check-icon { font-size: 3.5rem; margin-bottom: 15px; }
    .success-message h2 { color: #27ae60; margin-bottom: 10px; font-size: 1.4rem; }
    .success-message p { color: #666; margin-bottom: 8px; font-size: 0.95rem; }

    .success-message .detail {
      background: #f4f6f9;
      border-radius: 10px;
      padding: 16px 18px;
      margin: 18px 0;
      text-align: left;
    }

    .success-message .detail p { margin-bottom: 5px; font-size: 0.9rem; }
    .success-message .detail strong { color: #2c3e50; }

    .btn-new {
      padding: 12px 30px;
      background: linear-gradient(135deg, #4a90d9, #357abd);
      color: #fff;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-family: 'DM Sans', sans-serif;
      cursor: pointer;
      margin-top: 15px;
      box-shadow: 0 4px 12px rgba(74,144,217,0.25);
    }

    .btn-new:hover { background: linear-gradient(135deg, #357abd, #2a6aad); }

    #captureCanvas { display: none; }

    /* === Mobile adjustments === */
    @media (max-width: 480px) {
      .header-section { padding: 24px 22px 22px; }
      .header-section h1 { font-size: 1.35rem; }
      .form-body { padding: 24px 22px 28px; }
      .termo-box { padding: 14px 14px; }
      .termo-box p { font-size: 0.8rem; }
    }
  </style>
</head>
<body>

  <div class="container">
    <div id="formSection">
      <!-- Cabe√ßalho com o termo -->
      <div class="header-section">
        <h1>Registro de Entrega</h1>
        <p class="subtitle">Preencha os dados da entrega do VMix</p>

        <div class="termo-box">
          <span class="termo-label">Termo de Responsabilidade</span>
          <p>Pelo presente instrumento particular, o(a) abaixo identificado(a), denominado(a) simplesmente "Respons√°vel", declara para os devidos fins que recebeu da empresa <strong>LIVEMODE SERVI√áOS DE MARKETING ESPORTIVO LTDA</strong> o equipamento <strong>VMix</strong>, conforme especificado abaixo, comprometendo-se a zelar pela sua conserva√ß√£o e integridade durante o per√≠odo de uso.</p>
        </div>
      </div>

      <!-- Corpo do formul√°rio -->
      <div class="form-body">
        <form id="vmixForm">
          <div class="form-group">
            <label>Empresa <span class="required">*</span></label>
            <select id="empresa" required>
              <option value="">Selecione a empresa</option>
              <option value="Multiv√≠deo">Multiv√≠deo</option>
              <option value="kapta">Kapta</option>
              <option value="eptv">EPTV</option>
              <option value="Contra Ataque">Contra Ataque</option>
              <option value="RA Produ√ß√µes">RA Produ√ß√µes</option>
              <option value="TVClube">TV Clube</option>
              <option value="PW Video">PW Video</option>
              <option value="CromaMix">CromaMix</option>
              <option value="Conecta">Conecta</option>
              <option value="Conecta">LiveMode RJ</option>
              <option value="Conecta">LiveMode SP</option>
            </select>
          </div>

          <div class="form-group">
            <label>Respons√°vel pelo recebimento <span class="required">*</span></label>
            <input type="text" id="recebedor" placeholder="Ex: Jo√£o Silva" required>
          </div>

          <div class="form-group">
            <label>N√∫mero do VMix <span class="required">*</span></label>
            <select id="vmix" required>
              <option value="">Selecione o VMix</option>
              <option value="VMix 1">VMix 1</option>
              <option value="VMix 2">VMix 2</option>
              <option value="VMix 3">VMix 3</option>
              <option value="VMix 4">VMix 4</option>
              <option value="VMix 5">VMix 5</option>
              <option value="VMix 6">VMix 6</option>
              <option value="VMix 7">VMix 7</option>
              <option value="VMix 8">VMix 8</option>
            </select>
          </div>

          <div class="form-group">
            <label>Fotos do VMix <span class="required">*</span></label>

            <div id="cameraStartBtn" class="btn-start-camera" onclick="startCamera()">
              <span class="camera-icon">üì∑</span>
              <span>Toque para abrir a C√¢mera</span>
              <small>Tire quantas fotos precisar</small>
            </div>

            <div id="cameraSection" class="camera-section" style="display:none;">
              <video id="cameraVideo" class="camera-view" autoplay playsinline></video>
              <div class="camera-controls">
                <button type="button" class="btn-camera-action" onclick="switchCamera()">üîÑ Trocar</button>
                <button type="button" class="btn-capture" onclick="capturePhoto()" title="Tirar foto"></button>
                <button type="button" class="btn-camera-action" onclick="stopCamera()">‚úï Fechar</button>
              </div>
            </div>

            <div id="photosGrid" class="photos-grid"></div>
            <p id="photoCount" class="photo-count"></p>
          </div>

          <button type="submit" class="btn-submit" id="btnSubmit">Registrar Entrega</button>
        </form>
      </div>
    </div>

    <div class="success-message" id="successSection">
      <div class="check-icon">‚úÖ</div>
      <h2>Entrega Registrada!</h2>
      <p>Os dados foram enviados com sucesso.</p>
      <div class="detail" id="summaryDetail"></div>
      <button class="btn-new" onclick="resetForm()">Novo Registro</button>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <p class="loading-text">Enviando dados...</p>
  </div>

  <canvas id="captureCanvas"></canvas>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyHRrZCKWmL64iMjUcL_9n6qNLG14iSPssJ2YGm1td_DBSR_voKl3HKtUfxP8DUS7dk/exec';

    let capturedPhotos = [];
    let cameraStream = null;
    let facingMode = 'environment';

    async function startCamera() {
      try {
        cameraStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: facingMode, width: { ideal: 1280 }, height: { ideal: 720 } }
        });
        document.getElementById('cameraVideo').srcObject = cameraStream;
        document.getElementById('cameraStartBtn').style.display = 'none';
        document.getElementById('cameraSection').style.display = 'block';
      } catch (err) {
        alert('N√£o foi poss√≠vel acessar a c√¢mera.\nVerifique as permiss√µes do navegador.\n\nErro: ' + err.message);
      }
    }

    function stopCamera() {
      if (cameraStream) {
        cameraStream.getTracks().forEach(t => t.stop());
        cameraStream = null;
      }
      document.getElementById('cameraSection').style.display = 'none';
      document.getElementById('cameraStartBtn').style.display = 'flex';
    }

    async function switchCamera() {
      facingMode = facingMode === 'environment' ? 'user' : 'environment';
      if (cameraStream) cameraStream.getTracks().forEach(t => t.stop());
      await startCamera();
    }

    function capturePhoto() {
      const video = document.getElementById('cameraVideo');
      const canvas = document.getElementById('captureCanvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      canvas.getContext('2d').drawImage(video, 0, 0);

      capturedPhotos.push(canvas.toDataURL('image/jpeg', 0.8));
      renderPhotoGrid();

      video.style.opacity = '0.3';
      setTimeout(() => { video.style.opacity = '1'; }, 150);
    }

    function removePhoto(i) {
      capturedPhotos.splice(i, 1);
      renderPhotoGrid();
    }

    function renderPhotoGrid() {
      const grid = document.getElementById('photosGrid');
      grid.innerHTML = capturedPhotos.map((p, i) => `
        <div class="photo-thumb">
          <img src="${p}" alt="Foto ${i+1}">
          <button type="button" class="remove-photo" onclick="removePhoto(${i})">‚úï</button>
        </div>
      `).join('');

      document.getElementById('photoCount').textContent =
        capturedPhotos.length ? `${capturedPhotos.length} foto(s) capturada(s)` : '';
    }

    document.getElementById('vmixForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const empresa   = document.getElementById('empresa').value.trim();
      const recebedor = document.getElementById('recebedor').value.trim();
      const vmix      = document.getElementById('vmix').value.trim();

      if (!empresa || !recebedor || !vmix) {
        alert('Preencha todos os campos.');
        return;
      }
      if (capturedPhotos.length === 0) {
        alert('Tire pelo menos uma foto do VMix.');
        return;
      }

      stopCamera();

      document.getElementById('loadingOverlay').classList.add('show');
      document.getElementById('btnSubmit').disabled = true;

      try {
        const payload = {
          empresa,
          recebedor,
          vmix,
          fotos: capturedPhotos
        };

        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'text/plain' },
          body: JSON.stringify(payload)
        });

        const dataHora = new Date().toLocaleString('pt-BR');
        document.getElementById('summaryDetail').innerHTML = `
          <p><strong>Empresa:</strong> ${empresa}</p>
          <p><strong>Recebedor:</strong> ${recebedor}</p>
          <p><strong>VMix:</strong> ${vmix}</p>
          <p><strong>Fotos:</strong> ${capturedPhotos.length} foto(s)</p>
          <p><strong>Data/Hora:</strong> ${dataHora}</p>
        `;

        document.getElementById('formSection').style.display = 'none';
        document.getElementById('successSection').style.display = 'block';

      } catch (err) {
        alert('Erro ao enviar. Verifique sua conex√£o e tente novamente.\n\n' + err.message);
      } finally {
        document.getElementById('loadingOverlay').classList.remove('show');
        document.getElementById('btnSubmit').disabled = false;
      }
    });

    function resetForm() {
      document.getElementById('vmixForm').reset();
      capturedPhotos = [];
      renderPhotoGrid();
      document.getElementById('formSection').style.display = 'block';
      document.getElementById('successSection').style.display = 'none';
    }
  </script>

</body>
</html>
